<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏î (ThaiPersonalCardExtract)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 960px;
      width: 100%;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #4b5563;
      margin-bottom: 16px;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 16px;
    }
    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: #ffffff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1rem;
      color: #111827;
    }
    .card-desc {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .field {
      margin-bottom: 10px;
    }
    .field label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #374151;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .btn-primary {
      background: #2563eb;
      color: white;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    .preview-wrapper {
      margin-top: 8px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #cameraPreview {
      width: 100%;
      max-height: 260px;
      border-radius: 10px;
      background: #000;
      object-fit: cover;
    }
    #capturedImage {
      max-width: 100%;
      max-height: 140px;
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      display: none;
      object-fit: contain;
      background: #f9fafb;
    }
    .status {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #6b7280;
    }
    .status.success {
      color: #15803d;
    }
    .status.error {
      color: #b91c1c;
    }
    .pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef2ff;
      color: #4f46e5;
      margin-bottom: 6px;
    }
    .footer-note {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 8px;
      line-height: 1.4;
    }
    .field input,
    .field textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      outline: none;
    }
    .field input:focus,
    .field textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px #2563eb33;
    }
    #ocrRaw {
      font-size: 0.75rem;
      color: #4b5563;
    }
    .config-section {
      background: #fef3c7;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid #fbbf24;
    }
    .config-section label {
      font-size: 0.8rem;
      font-weight: 500;
      color: #92400e;
    }
    .config-section input {
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏î (ThaiPersonalCardExtract)</h1>
    <p class="subtitle">
      ‡∏Å‡∏î "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á &amp; ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô" ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏à‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á  
      ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ ThaiPersonalCardExtract (Python OCR) ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    </p>

    <div class="layout">
      <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Å‡∏•‡πâ‡∏≠‡∏á + Live Scan -->
      <div class="card">
        <div class="pill">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 : ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á &amp; ‡∏™‡πà‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£</div>
        <div class="card-title">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏î (‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ü‡∏£‡∏°)</div>
        <p class="card-desc">
          ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô HTTPS (‡πÄ‡∏ä‡πà‡∏ô Vercel / Netlify / localhost ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô secure)  
          ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á &gt; ‡πÄ‡∏≠‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏à‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î &gt; ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å ‡πÜ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        </p>

        <div class="config-section">
          <label for="apiUrl">üîß API Endpoint (Backend URL)</label>
          <input 
            type="text" 
            id="apiUrl" 
            value="/api/scan-card"
            placeholder="/api/scan-card ‡∏´‡∏£‡∏∑‡∏≠ https://your-app.vercel.app/api/scan-card"
          />
          <p style="font-size:0.7rem; margin-top:4px; color:#92400e;">
            üí° ‡πÉ‡∏ä‡πâ /api/scan-card ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Vercel deployment ‡∏´‡∏£‡∏∑‡∏≠ http://localhost:5000/api/scan-card ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö local
          </p>
        </div>

        <div class="field" style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn btn-primary" id="openCameraButton">
            üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á &amp; ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô
          </button>
          <button class="btn btn-secondary" id="stopScanButton" disabled>
            ‚úñÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô / ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
        </div>

        <div class="preview-wrapper">
          <video id="cameraPreview" autoplay playsinline muted></video>

          <div>
            <label style="font-size:0.8rem; color:#4b5563;">
              ‡πÄ‡∏ü‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Preview)
            </label>
            <img id="capturedImage" alt="‡πÄ‡∏ü‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OCR" />
          </div>
        </div>

        <div id="scanStatus" class="status"></div>

        <p class="footer-note">
          ‚ö†Ô∏è ‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ ThaiPersonalCardExtract (Python backend) ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÑ‡∏ó‡∏¢  
          ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ Tesseract.js ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î ‡πÅ‡∏™‡∏á ‡πÅ‡∏•‡∏∞‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á  
          ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ encryption / PDPA / access control ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
        </p>
      </div>

      <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏ü‡∏≠‡∏£‡πå‡∏° autofill -->
      <div class="card">
        <div class="pill">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OCR (autofill ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå)</div>
        <div class="card-title">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ï‡∏£</div>
        <p class="card-desc">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° parse ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å OCR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥  
          ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </p>

        <form id="idForm" onsubmit="return false;">
          <div class="field">
            <label for="citizenId">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
            <input id="citizenId" name="citizenId" maxlength="13" />
          </div>

          <div class="field">
            <label for="firstName">‡∏ä‡∏∑‡πà‡∏≠</label>
            <input id="firstName" name="firstName" />
          </div>

          <div class="field">
            <label for="lastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input id="lastName" name="lastName" />
          </div>

          <div class="field">
            <label for="dob">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</label>
            <input id="dob" name="dob" placeholder="dd-mm-yyyy" />
          </div>

          <div class="field">
            <label for="religion">‡∏®‡∏≤‡∏™‡∏ô‡∏≤</label>
            <input id="religion" name="religion" />
          </div>

          <div class="field">
            <label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£</label>
            <textarea id="address" name="address" rows="3"></textarea>
          </div>

          <div class="field">
            <label for="issueDate">‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£</label>
            <input id="issueDate" name="issueDate" />
          </div>

          <div class="field">
            <label for="expireDate">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
            <input id="expireDate" name="expireDate" />
          </div>

          <div class="field">
            <label for="ocrRaw">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å OCR (JSON Response)</label>
            <textarea id="ocrRaw" rows="4" readonly></textarea>
          </div>

          <button
            type="button"
            class="btn btn-secondary"
            id="saveButton"
          >
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏î‡πÇ‡∏°‡πà)
          </button>
          <div id="saveStatus" class="status"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const openCameraButton = document.getElementById("openCameraButton");
    const stopScanButton = document.getElementById("stopScanButton");
    const cameraPreview = document.getElementById("cameraPreview");
    const capturedImage = document.getElementById("capturedImage");
    const scanStatus = document.getElementById("scanStatus");
    const saveButton = document.getElementById("saveButton");
    const saveStatus = document.getElementById("saveStatus");
    const apiUrlInput = document.getElementById("apiUrl");

    const citizenIdInput = document.getElementById("citizenId");
    const firstNameInput = document.getElementById("firstName");
    const lastNameInput = document.getElementById("lastName");
    const dobInput = document.getElementById("dob");
    const religionInput = document.getElementById("religion");
    const addressInput = document.getElementById("address");
    const issueDateInput = document.getElementById("issueDate");
    const expireDateInput = document.getElementById("expireDate");
    const ocrRawTextarea = document.getElementById("ocrRaw");

    let cameraStream = null;
    let scanIntervalId = null;
    let isScanningFrame = false;

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    openCameraButton.addEventListener("click", async () => {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        scanStatus.textContent = "‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á (getUserMedia)";
        scanStatus.className = "status error";
        return;
      }

      try {
        scanStatus.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á...";
        scanStatus.className = "status";

        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false,
        });

        cameraPreview.srcObject = cameraStream;
        openCameraButton.disabled = true;
        stopScanButton.disabled = false;

        scanStatus.textContent =
          "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏≠‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏à‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÉ‡∏ô‡πÄ‡∏ü‡∏£‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å ‡πÜ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ";
        scanStatus.className = "status success";

        cameraPreview.onloadedmetadata = () => {
          cameraPreview.play();
          startAutoScan();
        };
      } catch (error) {
        console.error("Error opening camera:", error);
        scanStatus.textContent =
          "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô HTTPS)";
        scanStatus.className = "status error";
      }
    });

    function startAutoScan() {
      if (scanIntervalId) {
        clearInterval(scanIntervalId);
      }
      scanIntervalId = setInterval(() => {
        scanCurrentFrameWithOCR();
      }, 5000); // ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥
    }

    function stopScanningAndCamera() {
      if (scanIntervalId) {
        clearInterval(scanIntervalId);
        scanIntervalId = null;
      }
      if (cameraStream) {
        cameraStream.getTracks().forEach((track) => track.stop());
        cameraStream = null;
      }
      cameraPreview.srcObject = null;

      openCameraButton.disabled = false;
      stopScanButton.disabled = true;

      scanStatus.textContent = "‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß";
      scanStatus.className = "status";
    }

    stopScanButton.addEventListener("click", () => {
      stopScanningAndCamera();
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: OCR ‡∏à‡∏≤‡∏Å‡πÄ‡∏ü‡∏£‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡∏™‡πà‡∏á‡πÑ‡∏õ backend API
    async function scanCurrentFrameWithOCR() {
      if (!cameraStream) return;
      if (isScanningFrame) return;

      const video = cameraPreview;
      if (!video.videoWidth || !video.videoHeight) {
        console.log("Video not ready yet");
        return;
      }

      isScanningFrame = true;
      scanStatus.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏™‡∏î...";
      scanStatus.className = "status";

      try {
        // 1) capture frame ‡∏à‡∏≤‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const imageDataUrl = canvas.toDataURL("image/png");
        capturedImage.src = imageDataUrl;
        capturedImage.style.display = "block";

        // 2) ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend API
        const apiUrl = apiUrlInput.value.trim();
        if (!apiUrl) {
          throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ API URL");
        }

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            image: imageDataUrl
          })
        });

        if (!response.ok) {
          throw new Error(`API Error: ${response.status} ${response.statusText}`);
        }

        const result = await response.json();
        console.log("API Response:", result);

        if (!result.success) {
          throw new Error(result.error || 'Unknown error');
        }

        // 3) ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        const data = result.data;
        citizenIdInput.value = data.citizenId || "";
        firstNameInput.value = data.firstName || "";
        lastNameInput.value = data.lastName || "";
        dobInput.value = data.dob || "";
        religionInput.value = data.religion || "";
        addressInput.value = data.address || "";
        issueDateInput.value = data.issueDate || "";
        expireDateInput.value = data.expireDate || "";
        ocrRawTextarea.value = JSON.stringify(result.raw, null, 2);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° status ‡∏ï‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á
        const found = [];
        if (data.citizenId) found.push("‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£");
        if (data.firstName || data.lastName) found.push("‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•");
        if (data.dob) found.push("‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î");
        if (data.address) found.push("‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà");
        if (data.religion) found.push("‡∏®‡∏≤‡∏™‡∏ô‡∏≤");

        if (found.length > 0) {
          scanStatus.textContent =
            "‚úÖ ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OCR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + found.join(", ") + " (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)";
          scanStatus.className = "status success";
        } else {
          scanStatus.textContent =
            "‚ö†Ô∏è ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á parse ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏¢‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
          scanStatus.className = "status error";
        }
      } catch (error) {
        console.error("OCR error:", error);
        scanStatus.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message;
        scanStatus.className = "status error";
      } finally {
        isScanningFrame = false;
      }
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏î‡πÇ‡∏°‡πà)
    saveButton.addEventListener("click", () => {
      const payload = {
        citizenId: citizenIdInput.value,
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        dob: dobInput.value,
        religion: religionInput.value,
        address: addressInput.value,
        issueDate: issueDateInput.value,
        expireDate: expireDateInput.value,
        ocrText: ocrRawTextarea.value,
      };

      console.log("Demo payload:", payload);
      saveStatus.textContent =
        "‚úÖ ‡πÄ‡∏î‡πÇ‡∏°‡πà: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÉ‡∏ô Console ‡∏Ç‡∏≠‡∏á Browser)";
      saveStatus.className = "status success";
    });
  </script>
</body>
</html>
