<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (OCR ‡∏à‡∏£‡∏¥‡∏á)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ‡πÇ‡∏´‡∏•‡∏î Tesseract.js ‡∏à‡∏≤‡∏Å CDN -->
  <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 960px;
      width: 100%;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #4b5563;
      margin-bottom: 16px;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 16px;
    }
    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: #ffffff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1rem;
      color: #111827;
    }
    .card-desc {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .field {
      margin-bottom: 10px;
    }
    .field label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #374151;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .btn-primary {
      background: #2563eb;
      color: white;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    .preview-wrapper {
      margin-top: 8px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #cameraPreview {
      width: 100%;
      max-height: 260px;
      border-radius: 10px;
      background: #000;
      object-fit: cover;
    }
    #capturedImage {
      max-width: 100%;
      max-height: 180px;
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      display: none;
      object-fit: contain;
      background: #f9fafb;
    }
    .status {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #6b7280;
    }
    .status.success {
      color: #15803d;
    }
    .status.error {
      color: #b91c1c;
    }
    .pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef2ff;
      color: #4f46e5;
      margin-bottom: 6px;
    }
    .footer-note {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 8px;
      line-height: 1.4;
    }
    .field input,
    .field textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      outline: none;
    }
    .field input:focus,
    .field textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px #2563eb33;
    }
    #ocrRaw {
      font-size: 0.75rem;
      color: #4b5563;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (OCR ‡∏à‡∏£‡∏¥‡∏á)</h1>
    <p class="subtitle">
      ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ &gt; ‡∏™‡πà‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ï‡∏£ &gt; ‡∏Å‡∏î ‚Äú‡∏ñ‡πà‡∏≤‡∏¢ &amp; ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‚Äù &gt; ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Tesseract.js ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ  
      <br>‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å OCR ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    </p>

    <div class="layout">
      <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡∏™‡πÅ‡∏Å‡∏ô -->
      <div class="card">
        <div class="pill">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 : ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á &amp; ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£</div>
        <div class="card-title">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</div>
        <p class="card-desc">
          ‡∏Å‡∏î ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‚Äù ‚Üí ‡πÄ‡∏•‡πá‡∏á‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ü‡∏£‡∏°‡∏ä‡∏±‡∏î ‡πÜ ‚Üí ‡∏Å‡∏î ‚Äú‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ &amp; ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‚Äù  
          ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô HTTPS (‡πÄ‡∏ä‡πà‡∏ô Vercel / localhost ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô secure)
        </p>

        <div class="field" style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn btn-primary" id="openCameraButton">
            üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
          <button class="btn btn-secondary" id="captureButton" disabled>
            üîç ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ &amp; ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£
          </button>
          <button class="btn btn-secondary" id="closeCameraButton" disabled>
            ‚úñÔ∏è ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
        </div>

        <div class="preview-wrapper">
          <video id="cameraPreview" autoplay playsinline muted></video>

          <div>
            <label style="font-size:0.8rem; color:#4b5563;">
              ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ OCR)
            </label>
            <img id="capturedImage" alt="‡∏†‡∏≤‡∏û‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á" />
          </div>
        </div>

        <div id="scanStatus" class="status"></div>

        <p class="footer-note">
          ‚ö†Ô∏è ‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ OCR ‡∏ù‡∏±‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (Tesseract.js) ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö POC/‡∏ó‡∏î‡∏™‡∏≠‡∏ö UX  
          ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ backend, ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™, PDPA, log ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
        </p>
      </div>

      <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏ü‡∏≠‡∏£‡πå‡∏° autofill -->
      <div class="card">
        <div class="pill">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ï‡∏£ (autofill)</div>
        <div class="card-title">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OCR</div>
        <p class="card-desc">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á ‚Äú‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å‚Äù ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° OCR  
          ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° OCR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡∏î‡∏π
        </p>

        <form id="idForm" onsubmit="return false;">
          <div class="field">
            <label for="citizenId">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å OCR)</label>
            <input id="citizenId" name="citizenId" maxlength="13" />
          </div>

          <div class="field">
            <label for="firstName">‡∏ä‡∏∑‡πà‡∏≠ (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ parse ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</label>
            <input id="firstName" name="firstName" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å OCR raw" />
          </div>

          <div class="field">
            <label for="lastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ parse ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</label>
            <input id="lastName" name="lastName" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å OCR raw" />
          </div>

          <div class="field">
            <label for="dob">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î (‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)</label>
            <input id="dob" name="dob" placeholder="dd-mm-yyyy" />
          </div>

          <div class="field">
            <label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£ (‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å OCR raw)</label>
            <textarea id="address" name="address" rows="3"></textarea>
          </div>

          <div class="field">
            <label for="ocrRaw">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å OCR (‡∏î‡∏π/‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)</label>
            <textarea id="ocrRaw" rows="6" readonly></textarea>
          </div>

          <button
            type="button"
            class="btn btn-secondary"
            id="saveButton"
          >
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏î‡πÇ‡∏°‡πà)
          </button>
          <div id="saveStatus" class="status"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const openCameraButton = document.getElementById("openCameraButton");
    const closeCameraButton = document.getElementById("closeCameraButton");
    const captureButton = document.getElementById("captureButton");
    const cameraPreview = document.getElementById("cameraPreview");
    const capturedImage = document.getElementById("capturedImage");
    const scanStatus = document.getElementById("scanStatus");
    const saveButton = document.getElementById("saveButton");
    const saveStatus = document.getElementById("saveStatus");

    const citizenIdInput = document.getElementById("citizenId");
    const firstNameInput = document.getElementById("firstName");
    const lastNameInput = document.getElementById("lastName");
    const dobInput = document.getElementById("dob");
    const addressInput = document.getElementById("address");
    const ocrRawTextarea = document.getElementById("ocrRaw");

    let cameraStream = null;

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    openCameraButton.addEventListener("click", async () => {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        scanStatus.textContent = "‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á (getUserMedia)";
        scanStatus.className = "status error";
        return;
      }

      try {
        scanStatus.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á...";
        scanStatus.className = "status";

        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" }, // ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
          audio: false,
        });

        cameraPreview.srcObject = cameraStream;
        captureButton.disabled = false;
        closeCameraButton.disabled = false;

        scanStatus.textContent =
          "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÉ‡∏ô‡πÄ‡∏ü‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ & ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‚Äù";
        scanStatus.className = "status success";
      } catch (error) {
        console.error("Error opening camera:", error);
        scanStatus.textContent =
          "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô HTTPS)";
        scanStatus.className = "status error";
      }
    });

    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    closeCameraButton.addEventListener("click", () => {
      if (cameraStream) {
        cameraStream.getTracks().forEach((track) => track.stop());
        cameraStream = null;
      }
      cameraPreview.srcObject = null;
      captureButton.disabled = true;
      closeCameraButton.disabled = true;

      scanStatus.textContent = "‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß";
      scanStatus.className = "status";
    });

    // ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ & ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ OCR ‡∏à‡∏£‡∏¥‡∏á
    captureButton.addEventListener("click", async () => {
      if (!cameraStream) {
        scanStatus.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á";
        scanStatus.className = "status error";
        return;
      }

      const video = cameraPreview;
      if (!video.videoWidth || !video.videoHeight) {
        scanStatus.textContent = "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏•‡∏≠‡∏á‡∏£‡∏≠ 1‚Äì2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
        scanStatus.className = "status error";
        return;
      }

      // 1) Capture frame ‡∏à‡∏≤‡∏Å video
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const imageDataUrl = canvas.toDataURL("image/png");
      capturedImage.src = imageDataUrl;
      capturedImage.style.display = "block";

      // 2) ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ OCR ‡∏î‡πâ‡∏ß‡∏¢ Tesseract.js
      scanStatus.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢ OCR (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5‚Äì10 ‡∏ß‡∏¥)...";
      scanStatus.className = "status";

      try {
        const result = await Tesseract.recognize(imageDataUrl, "eng", {
          logger: (m) => console.log(m),
        });

        const text = (result.data && result.data.text) ? result.data.text : "";
        console.log("OCR text:", text);

        // ‡πÅ‡∏™‡∏î‡∏á raw text ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å OCR
        ocrRawTextarea.value = text.trim();

        // 3) ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° OCR
        //    - ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å
        const digitsOnly = text.replace(/\D/g, ""); // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 0-9
        const idMatch = digitsOnly.match(/(\d{13})/);

        if (idMatch) {
          citizenIdInput.value = idMatch[1];
        } else {
          citizenIdInput.value = "";
        }

        scanStatus.textContent =
          idMatch
            ? "‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≤‡∏Å OCR ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á)"
            : "‡∏≠‡πà‡∏≤‡∏ô OCR ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏•‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà";
        scanStatus.className = idMatch ? "status success" : "status error";
      } catch (error) {
        console.error("OCR error:", error);
        scanStatus.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡πà‡∏≤‡∏ô OCR";
        scanStatus.className = "status error";
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏î‡πÇ‡∏°‡πà)
    saveButton.addEventListener("click", () => {
      const payload = {
        citizenId: citizenIdInput.value,
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        dob: dobInput.value,
        address: addressInput.value,
        ocrText: ocrRawTextarea.value,
      };

      console.log("Demo payload:", payload);
      saveStatus.textContent =
        "‡πÄ‡∏î‡πÇ‡∏°‡πà: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÉ‡∏ô Console ‡∏Ç‡∏≠‡∏á Browser)";
      saveStatus.className = "status success";
    });
  </script>
</body>
</html>
